<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Breakout and Bond</title>
<link rel="icon" href="https://via.placeholder.com/32/FFCC00/000000?text=F" type="image/png">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

<style>
    /* Universal Box Sizing for better layout control */
    html, body {
        box-sizing: border-box;
    }
    *, *:before, *:after {
        box-sizing: inherit;
    }

    /* CSS Variables for easy theming - UPDATED TO BRAND COLORS */
    :root {
        /* Flyer Brand Colors */
        --flyer-teal-rgb: 56, 194, 213;
        --flyer-teal: rgb(56, 194, 213); /* Primary highlight, success, progress fill */

        --flyer-purple-rgb: 85, 64, 126;
        --flyer-purple: rgb(85, 64, 126); /* Selected tile, primary buttons */

        --flyer-red-rgb: 255, 90, 96;
        --flyer-red: rgb(255, 90, 96); /* Error, warning */

        --flyer-black: hsl(0, 0%, 20%);   /* Dark text */
        --flyer-white: hsl(0, 0%, 98%);    /* Near white background */

        /* Mapped Variables */
        --bg-lightest: var(--flyer-white);
        --bg-light: hsl(0, 0%, 93%); /* Slightly off-white for elements */
        --text-dark: var(--flyer-black);

        --primary-accent: var(--flyer-purple); /* Main interactive color */
        --secondary-neutral: hsl(0, 0%, 75%); /* Lighter gray for borders/muted elements */
        --success-color: var(--flyer-teal);
        --error-color: var(--flyer-red);

        /* Stage 3 specific color (already requested) */
        --connections-selected-color: var(--flyer-purple);

        --button-text-light: white; /* White text for buttons on dark backgrounds */

        --border-radius-base: 12px; /* ENHANCED: Increased for softer look */
        --padding-base: 1rem;
        --gap-small: 0.5rem;
        --gap-medium: 1rem;
        --gap-large: 2rem;
    }

    body {
        font-family: 'Inter', sans-serif; /* NEW FONT */
        /* UPDATED: More visible subtle background gradient for overall feel */
        background: linear-gradient(135deg, var(--bg-lightest) 0%, rgba(var(--flyer-teal-rgb), 0.03) 100%);
        color: var(--text-dark) !important;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        justify-content: flex-start;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        overflow-x: hidden; /* Prevent horizontal scroll from confetti/layout */
    }

    /* NEW: Global Header Styling */
    .global-header {
        width: 100%;
        background: var(--bg-light); /* Or a subtle gradient if desired */
        padding: var(--gap-medium) var(--gap-large);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); /* Soft shadow */
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky; /* Or fixed if preferred */
        top: 0;
        z-index: 100; /* Ensure it stays on top */
        border-bottom: 1px solid var(--primary-accent);
        box-sizing: border-box;
    }

    .global-header-title {
        font-family: 'Poppins', sans-serif;
        font-size: 1.8em;
        color: var(--flyer-purple); /* Main title in purple */
        margin: 0;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
    }

    .stage-indicator {
        font-family: 'Inter', sans-serif;
        font-size: 1.1em;
        font-weight: 600;
        color: var(--primary-accent);
    }

    /* NEW: Segmented Progress Bar */
    .progress-bar-container {
        width: 100%;
        max-width: 950px;
        margin: var(--gap-medium) 0;
        height: 8px;
        background-color: var(--secondary-neutral); /* Inactive background */
        border-radius: 4px;
        overflow: hidden;
        display: flex;
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
    }

    .progress-segment {
        flex: 1;
        background-color: transparent;
        height: 100%;
        transition: background-color 0.5s ease;
        border-right: 1px solid rgba(255,255,255,0.2); /* Visual separation */
    }

    .progress-segment:last-child {
        border-right: none;
    }

    .progress-segment.active {
        background-color: var(--primary-accent); /* Active color (Flyer Teal) */
    }


    #game-area {
        position: relative;
        width: 90%;
        max-width: 950px;
        flex-grow: 1;
        margin: var(--gap-large) 0;
        min-height: 550px;
        box-sizing: border-box;
    }

    .stage {
        padding: var(--gap-medium) var(--gap-large); /* CORRECTED PADDING */
        width: 100%;
        height: 100%;
        box-sizing: border-box;

        background: var(--bg-light) !important;
        border-radius: var(--border-radius-base); /* ENHANCED: Larger radius */
        /* ENHANCED: Softer, more spread out shadow */
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        border: 1px solid var(--primary-accent); /* Mapped to new neutral */

        position: absolute;
        top: 0;
        left: 0;

        display: flex;
        flex-direction: column;
        align-items: center;

        opacity: 0;
        visibility: hidden;
        transform: translateY(20px); /* Initial subtle offset for transition */
        transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out, transform 0.5s ease-in-out;
        overflow-y: auto;
    }

    .stage.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    /* NEW: Wrapper for stage title and icon */
    .stage-header-content {
        display: flex;
        align-items: center;
        gap: var(--gap-small);
        margin-bottom: var(--gap-small);
        justify-content: center; /* Center content when gap is small */
        width: 100%;
        flex-wrap: wrap; /* Allow wrapping on small screens */
    }

    .stage-header-content h1 {
        margin: 0; /* Remove default h1 margin when in flexbox */
    }

    .stage-header-content .stage-icon {
        font-size: 1.5em; /* Size of the emoji icon */
        line-height: 1; /* Align vertically with text */
    }

    h1 {
        font-family: 'Poppins', sans-serif; /* NEW FONT */
        text-align: center;
        margin-top: 0;
        /* margin-bottom: var(--gap-small); -> Moved to stage-header-content gap */
        color: var(--primary-accent) !important; /* Mapped to Flyer Teal */
        font-size: 2.2em;
        letter-spacing: 1px;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
    }

    /* New style for instruction paragraphs */
    .stage-instruction {
        text-align: center;
        margin-top: 0; /* Adjusted for new placement */
        margin-bottom: var(--gap-medium);
        color: var(--text-dark);
        font-style: italic;
        line-height: 1.4;
    }

    p {
        text-align: center;
        margin-bottom: var(--gap-small);
        line-height: 1.5;
        color: var(--text-dark);
    }

    .riddle-text {
        font-style: italic;
        text-align: center;
        padding: var(--gap-medium) var(--gap-large); /* ENHANCED: More padding */
        /* ENHANCED: Light transparent teal background */
        background-color: rgba(var(--flyer-teal-rgb), 0.1);
        border-radius: var(--border-radius-base);
        margin-bottom: var(--gap-large);
        /* ENHANCED: Prominent border-left */
        border: 1px solid var(--secondary-neutral);
        border-left: 5px solid var(--flyer-teal);
        color: var(--text-dark);
    }

    .input-box {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--gap-medium);
    }

    .input-box input[type="text"] {
        font-size: 1.1em;
        padding: var(--gap-small) var(--gap-medium);
        border-radius: var(--border-radius-base); /* ENHANCED: Larger radius */
        border: 2px solid var(--secondary-neutral); /* Mapped to new neutral */
        background-color: white;
        color: var(--text-dark);
        width: 80%;
        max-width: 380px; /* Adjusted for screenshot appearance */
        box-sizing: border-box;
        outline: none;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    .input-box input[type="text"]:focus {
        border-color: var(--primary-accent); /* Mapped to Flyer Teal */
        box-shadow: 0 0 0 3px rgba(var(--flyer-teal-rgb), 0.3); /* Mapped to Flyer Teal RGB */
    }

    /* General Button Styling */
    button {
        padding: 0.8rem 1.5rem;
        font-size: 1.1em;
        /* ENHANCED: Primary buttons now use Flyer Purple */
        background-color: var(--flyer-purple);
        color: var(--button-text-light);
        border: none;
        border-radius: var(--border-radius-base); /* ENHANCED: Larger radius */
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.2s ease;
        font-weight: bold;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    button:hover:not(:disabled) {
        background-color: hsl(265, 30%, 38%); /* Darker purple on hover */
        transform: translateY(-2px);
        box-shadow: 0 6px 8px rgba(0,0,0,0.15);
    }

    button:active:not(:disabled) {
        transform: translateY(1px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    button:disabled {
        background-color: var(--bg-light);
        color: var(--secondary-neutral);
        cursor: not-allowed;
        box-shadow: none;
    }

    /* NEW: Specific styling for the screenshot button (already purple, just ensuring consistency) */
    .final-message-button {
        margin-top: var(--gap-large);
        background-color: var(--flyer-purple); /* Flyer Purple for Screenshot Button */
        color: var(--button-text-light);
        padding: 1rem 2rem;
        font-size: 1.3em;
        box-shadow: 0 6px 10px rgba(0,0,0,0.15);
    }

    .final-message-button:hover:not(:disabled) {
        background-color: hsl(265, 30%, 38%); /* Slightly darker purple on hover */
        transform: translateY(-3px);
        box-shadow: 0 8px 12px rgba(0,0,0,0.2);
    }

    .final-message-button:active:not(:disabled) {
        transform: translateY(0px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }


    /* Stage 2: Word Search Specific Styles */
    .word-search-content-wrapper {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        align-items: flex-start;
        gap: var(--gap-large);
        width: 100%;
        padding: var(--gap-medium); /* CORRECTED PADDING */
        background-color: var(--bg-lightest);
        border-radius: var(--border-radius-base); /* ENHANCED: Larger radius */
        border: 2px solid var(--secondary-neutral); /* Mapped to new neutral */
        box-sizing: border-box;
        margin-bottom: var(--gap-medium);
        /* ENHANCED: Softer inner shadow for container */
        box-shadow: inset 0 0 8px rgba(0,0,0,0.05);
    }

    #grid {
        display: grid;
        grid-template-columns: repeat(15, minmax(30px, 1fr));
        grid-auto-rows: 30px;
        gap: 2px;
        width: fit-content;
        flex-shrink: 0;
        flex-grow: 0;
    }

    .cell {
        width: 100%;
        height: 100%;
        background: white;
        border: 1px solid var(--secondary-neutral); /* Mapped to new neutral */
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        user-select: none;
        font-weight: bold;
        font-size: 0.85em;
        color: var(--text-dark);
        /* ENHANCED: Subtle inner shadow for depth */
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.03);
        transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        border-radius: 2px;
    }
    .cell:hover:not(.selected):not(.found) {
        background-color: var(--bg-light);
        box-shadow: inset 0 1px 5px rgba(0,0,0,0.08);
    }


    .selected {
        background: var(--primary-accent); /* Mapped to Flyer Teal */
        border-color: var(--primary-accent);
        color: var(--button-text-light);
        box-shadow: inset 0 0 5px rgba(0,0,0,0.2); /* Deeper inner shadow when selected */
    }

    .found {
        background: var(--success-color); /* Mapped to Flyer Teal */
        color: var(--button-text-light);
        border-color: var(--success-color);
        animation: pulseFound 0.5s ease-out;
        box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
    }

    @keyframes pulseFound {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    #words-list-container {
        flex-basis: 180px;
        flex-grow: 1;
        min-width: 150px;
        padding: var(--gap-small);
        box-sizing: border-box;
    }

    #words-list-container h3 {
        color: var(--primary-accent); /* Mapped to Flyer Teal */
        text-align: center;
        margin-top: 0;
        margin-bottom: var(--gap-small);
        font-size: 1.2em;
    }

    #words {
        margin-top: 0;
        column-count: 1;
        list-style: none;
        padding: 0;
    }

    #words li {
        margin-bottom: 5px;
        color: var(--text-dark);
        font-size: 1.0em;
        transition: text-decoration 0.3s ease, color 0.3s ease;
    }

    #words li.found-word-list {
        text-decoration: line-through;
        color: var(--success-color); /* Mapped to Flyer Teal */
        font-weight: bold;
    }

    /* Stage 3: Connections Game Specific Styles */
    #connections-container {
        max-width: 800px;
        margin: var(--gap-medium) auto;
        padding: var(--gap-medium); /* CORRECTED PADDING */
        background-color: var(--bg-lightest);
        border-radius: var(--border-radius-base); /* ENHANCED: Larger radius */
        border: 2px solid var(--secondary-neutral); /* Mapped to new neutral */
        box-sizing: border-box;
        width: 100%;
        /* ENHANCED: Softer inner shadow for container */
        box-shadow: inset 0 0 8px rgba(0,0,0,0.05);
    }

    #found-groups {
        margin-bottom: 2rem;
    }

    .group {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
        align-items: center;
        padding: 0.5rem;
        /* UPDATED: Dynamic background color set by JS for found groups */
        border-radius: var(--border-radius-base); /* ENHANCED: Larger radius */
        border: 1px solid var(--secondary-neutral); /* Mapped to new neutral */
        box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Subtle shadow for found groups */
        transition: background-color 0.3s ease; /* Smooth transition for color change */
    }

    .group-label {
        font-weight: bold;
        color: var(--text-dark); /* Changed to dark text, as background color will vary */
        margin-right: 1rem;
        flex-basis: 100%;
        text-align: center;
        margin-bottom: 0.5rem;
        text-shadow: 0 1px 1px rgba(0,0,0,0.02);
    }

    #connections-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        margin-bottom: 2rem;
    }

    .tile {
        padding: 1rem;
        border: 2px solid var(--secondary-neutral); /* Mapped to new neutral */
        border-radius: var(--border-radius-base); /* ENHANCED: Larger radius */
        cursor: pointer;
        background-color: white;
        color: var(--text-dark);
        /* ENHANCED: Subtle inner shadow for depth and smooth transitions */
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.03), 0 2px 4px rgba(0,0,0,0.08);
        transition: transform 0.2s, background-color 0.3s, color 0.3s, border-color 0.3s, box-shadow 0.3s;
        font-size: 16px;
        font-weight: bold;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 70px;
    }
    .tile:hover:not(.selected):not(.locked) {
        transform: translateY(-2px);
        box-shadow: inset 0 1px 5px rgba(0,0,0,0.08), 0 4px 8px rgba(0,0,0,0.12);
    }

    /* UPDATED: Softer purple for selected tile */
    .tile.selected {
        background-color: rgba(var(--flyer-purple-rgb), 0.2); /* Faint purple */
        color: var(--text-dark); /* Keep text dark for readability on faint background */
        border-color: var(--connections-selected-color); /* Solid purple border for definition */
        box-shadow: inset 0 0 5px rgba(0,0,0,0.2), 0 2px 8px rgba(0,0,0,0.2); /* Stronger shadow when selected */
    }

    /* UPDATED: Locked tiles get their color from parent group via JS inline style */
    .tile.locked {
        cursor: default;
        color: var(--text-dark); /* Text color remains dark for readability */
        border-color: rgba(0,0,0,0.1); /* Lighter border when locked */
        box-shadow: inset 0 0 5px rgba(0,0,0,0.2); /* Flat shadow when locked */
    }

    .tile.wrong {
        border-color: var(--error-color); /* Mapped to Flyer Red */
        animation: shake 0.3s;
    }

    @keyframes shake {
        0% { transform: translateX(0); }
        25% { transform: translateX(-4px); }
        50% { transform: translateX(4px); }
        75% { transform: translateX(-4px); }
        100% { transform: translateX(0); }
    }

    #connections-buttons {
        display: flex;
        justify-content: center;
        gap: 1rem;
    }

    .btn-restart-connections {
        background-color: var(--primary-accent); /* Mapped to Flyer Teal */
        color: var(--button-text-light);
    }

    /* Stage 4: Team Match */
    #prompt-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: var(--gap-large);
        margin-top: var(--gap-large);
        width: 100%;
    }

    .prompt {
        background: var(--bg-light);
        border: 2px solid var(--secondary-neutral); /* Mapped to new neutral */
        padding: var(--padding-base);
        border-radius: var(--border-radius-base); /* ENHANCED: Larger radius */
        display: flex;
        flex-direction: column;
        gap: var(--gap-small);
        box-shadow: 0 2px 5px rgba(0,0,0,0.08); /* Subtle shadow */
    }

    .prompt p {
        margin: 0;
        font-size: 0.9em;
        color: var(--primary-accent); /* Mapped to Flyer Teal */
        text-align: left;
        font-weight: bold;
    }

    .prompt input {
        width: 100%;
        padding: 0.5rem;
        font-size: 1em;
        border-radius: var(--border-radius-base); /* ENHANCED: Larger radius */
        border: 2px solid var(--secondary-neutral); /* Mapped to new neutral */
        background-color: white;
        color: var(--text-dark);
        box-sizing: border-box;
        outline: none;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    .prompt input:focus {
        border-color: var(--primary-accent); /* Mapped to Flyer Teal */
        box-shadow: 0 0 0 3px rgba(var(--flyer-teal-rgb), 0.3); /* Mapped to Flyer Teal RGB */
    }

    /* Notification Area */
    #notificationArea {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        border-radius: var(--border-radius-base);
        font-weight: bold;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    #notificationArea.success {
        background-color: var(--success-color); /* Mapped to Flyer Teal */
        color: var(--button-text-light);
    }

    #notificationArea.error {
        background-color: var(--error-color); /* Mapped to Flyer Red */
        color: var(--button-text-light);
    }
    /* NEW: Info notification for screenshot */
    #notificationArea.info {
        background-color: hsl(210, 20%, 85%); /* Light gray-blue for info */
        color: var(--text-dark);
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }


    #notificationArea.visible {
        opacity: 1;
        visibility: visible;
    }

    /* NEW: Confetti Animation Styles */
    #confetti-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none; /* Allows clicks to pass through */
        z-index: 9999;
        overflow: hidden; /* Prevent scrollbars from confetti */
    }

    .confetti-particle {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: var(--primary-accent); /* Default confetti color (Teal) */
        border-radius: 50%; /* Make them circular */
        opacity: 0;
        animation: confetti-fall 2s forwards ease-out;
    }

    /* Colors for confetti particles */
    .confetti-particle:nth-child(3n) { background-color: var(--flyer-purple); }
    .confetti-particle:nth-child(5n) { background-color: var(--flyer-red); }
    .confetti-particle:nth-child(7n) { background-color: var(--flyer-teal); }
    .confetti-particle:nth-child(11n) { background-color: white; }

    @keyframes confetti-fall {
        0% {
            transform: translate(0, -100vh) rotateZ(0deg);
            opacity: 1;
        }
        100% {
            transform: translate(var(--x-end), var(--y-end)) rotateZ(720deg);
            opacity: 0;
        }
    }


    /* Media queries for responsiveness */
    /* Tablet & Smaller Laptop Landscape */
    @media (max-width: 900px) {
        .global-header {
            padding: var(--gap-small) var(--gap-medium);
        }
        .global-header-title {
            font-size: 1.5em;
        }
        .stage-indicator {
            font-size: 1em;
        }
        .progress-bar-container {
            margin: var(--gap-small) 0;
        }
        #game-area {
            min-height: 520px;
            margin: var(--gap-medium) 0;
        }
        .stage {
             padding: var(--gap-small) var(--gap-medium);
        }
        .riddle-text {
            padding: var(--gap-medium);
        }
    }

    /* Tablet Portrait & Large Phone Landscape */
    @media (max-width: 768px) {
        #game-area {
            min-height: 470px;
        }
        #grid {
            grid-template-columns: repeat(15, minmax(28px, 1fr));
            grid-auto-rows: 28px;
        }
        .cell {
            font-size: 0.8em;
        }
        #prompt-grid {
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        }
    }

    /* Smaller Phones & Tablet Portrait */
    @media (max-width: 500px) {
        .global-header-title {
            font-size: 1.2em;
        }
        .stage-indicator {
            font-size: 0.9em;
        }
        #game-area {
            min-height: 420px;
            margin: var(--gap-medium) 0;
        }
        .stage {
            padding: var(--gap-small);
        }
        h1 {
            font-size: 1.8em;
        }
        .stage-header-content .stage-icon {
            font-size: 1.2em;
        }
        .riddle-text {
            padding: var(--gap-small);
            font-size: 0.95em;
        }
        .input-box input[type="text"] {
            width: 90%;
            padding: 0.6rem 0.8rem;
            font-size: 1em;
        }
        button {
            padding: 0.7rem 1.2rem;
            font-size: 1em;
        }
        .final-message-button {
            padding: 0.8rem 1.5rem;
            font-size: 1.1em;
        }
        .word-search-content-wrapper {
            flex-direction: column;
            align-items: center;
            gap: var(--gap-small);
            padding: var(--gap-small);
        }
        #words-list-container {
            width: 100%;
            max-width: 250px;
            margin-top: 0;
        }
        #words {
            column-count: 2;
            text-align: left;
            width: 100%;
        }
        #words li {
             text-align: center;
        }
        #grid {
            grid-template-columns: repeat(15, minmax(24px, 1fr));
            grid-auto-rows: 24px;
            font-size: 0.7em;
            gap: 1px;
        }
        #connections-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        .tile {
            font-size: 14px;
            min-height: 60px;
            padding: 0.8rem;
        }
        .group-label {
            font-size: 0.9em;
        }
        #prompt-grid {
            gap: var(--gap-medium);
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        }
        .prompt input {
            padding: 0.4rem;
            font-size: 0.9em;
        }
    }

    /* Very Small Phones (e.g., iPhone SE portrait) */
    @media (max-width: 360px) {
        .global-header-title {
            font-size: 1em;
        }
        .stage-indicator {
            font-size: 0.8em;
        }
        #game-area {
            min-height: 380px;
            width: 95%;
        }
        h1 {
            font-size: 1.6em;
        }
        .stage-header-content .stage-icon {
            font-size: 1em;
        }
        .riddle-text {
            font-size: 0.9em;
            padding: var(--gap-small);
        }
        .input-box input[type="text"] {
            width: 95%;
            padding: 0.3rem 0.5rem;
            font-size: 0.85em;
        }
        #grid {
            grid-template-columns: repeat(15, minmax(18px, 1fr));
            grid-auto-rows: 18px;
            font-size: 0.6em;
            gap: 1px;
        }
        .cell {
            border-width: 0.5px;
        }
        #words li {
            font-size: 0.9em;
        }
        #connections-grid {
            gap: 5px;
        }
        .tile {
            font-size: 12px;
            min-height: 50px;
            padding: 0.5rem;
            border-width: 1px;
        }
        .group-label {
            font-size: 0.8em;
        }
        #prompt-grid {
            gap: var(--gap-small);
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
        .prompt input {
            padding: 0.4rem;
            font-size: 0.9em;
        }
    }

</style>
</head>
<body>

<header class="global-header">
    <h1 class="global-header-title">Breakout and Bond</h1>
    <div class="stage-indicator">Stage <span id="currentStageNumber">0</span> of 4</div>
</header>

<div class="progress-bar-container">
    <div class="progress-segment" data-segment="1"></div>
    <div class="progress-segment" data-segment="2"></div>
    <div class="progress-segment" data-segment="3"></div>
    <div class="progress-segment" data-segment="4"></div>
</div>

<div id="notificationArea" class="notification-message"></div>

<div id="confetti-container"></div>

<div id="game-area">
    <div class="stage active" data-stage="0">
        <p class="stage-instruction" id="stage-0-instruction"></p> <div class="stage-header-content">
            <span class="stage-icon">üöÄ</span>
            <h1>Welcome!</h1>
        </div>
        <div class="input-box">
            <input type="text" id="teamNameInput" placeholder="Enter team name..." />
            <button id="teamNameSubmitBtn">Start Game</button>
        </div>
    </div>

    <div class="stage" data-stage="1">
        <p id="stage-1-instruction" class="stage-instruction"></p> <div class="stage-header-content">
            <span class="stage-icon">üß©</span>
            <h1>Stage 1: Solve the Riddle</h1>
        </div>
        <p class="riddle-text">
            I am not a bird, yet I help you soar,<br>
            From shopfloor tasks to strategic core.<br>
            I don‚Äôt give wings, but I shift your view,<br>
            From technical depth to business too.<br>
            You started with tools, now you lead with insight,<br>
            Evolving each day, taking bold flight.<br>
            A first-line spark, with a curious mind,<br>
            What program am I ‚Äî for the driven, the kind?
        </p>
        <div class="input-box">
            <input type="text" id="riddleAnswer" placeholder="Enter here.." />
            <button id="riddleSubmitBtn">Submit</button>
        </div>
    </div>

    <div class="stage" data-stage="2">
        <p id="stage-2-instruction" class="stage-instruction"></p> <div class="stage-header-content">
            <span class="stage-icon">üîç</span>
            <h1>Stage 2: Word Search</h1>
        </div>
        
        <div class="word-search-content-wrapper">
            <div id="grid"></div> <div id="words-list-container">
                <h3>Words to Find</h3>
                <ul id="words">
                    </ul>
            </div>
        </div>
        <button id="toStage3" disabled style="display: none;">Next Stage</button>
    </div>

    <div class="stage" data-stage="3">
        <p id="stage-3-instruction" class="stage-instruction"></p> <div class="stage-header-content">
            <span class="stage-icon">üîó</span>
            <h1>Stage 3: Flyer Connections</h1>
        </div>
        
        <div id="connections-container">
            <div id="found-groups"></div>
            <div id="connections-grid"></div> <div id="connections-buttons">
                </div>
        </div>
    </div>

    <div class="stage" data-stage="4">
        <p id="stage-4-instruction" class="stage-instruction"></p> <div class="stage-header-content">
            <span class="stage-icon">ü§ù</span>
            <h1>Stage 4: Match the Team</h1>
        </div>
        
        <div id="prompt-grid">
            </div>
        <button id="screenshotButton" class="action-button final-message-button">Take Screenshot</button>
    </div>
</div> <script>
    // Configuration Object: Centralized game data
    const CONFIG = {
        riddle: {
            text: "I am not a bird, yet I help you soar,<br>From shopfloor tasks to strategic core.<br>I don‚Äôt give wings, but I shift your view,<br>From technical depth to business too.<br>You started with tools, now you lead with insight,<br>Evolving each day, taking bold flight.<br>A first-line spark, with a curious mind,<br>What program am I ‚Äî for the driven, the kind?",
            answer: "flyer",
            successMessage: "Correct! Advancing to the next challenge..."
        },
        wordSearch: {
            gridData: [
              ['C','O','L','L','A','B','O','R','A','T','E','B','P','L','I'],
              ['Z','J','K','M','N','P','Q','A','F','R','V','A','F','U','N'],
              ['W','E','I','M','P','A','C','T','Y','G','H','N','L','R','N'],
              ['X','Y','Z','L','A','U','N','C','H','N','J','G','Y','E','O'],
              ['S','T','R','A','T','E','G','Y','K','L','M','A','E','S','V'],
              ['Q','V','W','X','C','A','D','R','E','A','B','L','R','T','A'],
              ['J','K','G','R','O','W','T','H','P','Q','R','O','N','U','T'],
              ['S','F','T','U','V','W','X','Y','Z','G','H','R','C','V','E'],
              ['V','I','S','I','O','N','A','B','C','D','E','E','H','W','X'],
              ['K','L','M','N','O','P','Q','R','S','T','U','L','I','X','Y'],
              ['A','G','I','L','E','V','W','X','Y','Z','A','E','K','L','Z'],
              ['M','N','I','J','I','K','L','M','N','O','P','A','M','N','A'],
              ['O','P','Q','R','I','S','T','U','V','W','X','R','N','O','B'],
              ['S','T','U','V','M','W','X','Y','Z','A','B','N','O','P','C'],
              ['W','X','Y','Z','B','A','B','C','D','E','F','S','P','Q','D']
            ],
            words: [
                'COLLABORATE', 'IMPACT', 'STRATEGY', 'GROWTH', 'VISION', 'AGILE',
                'INNOVATE', 'FLYER', 'LAUNCH', 'LEARN'
            ]
        },
        connections: {
            categories: {
                "Roles you'll transition to": ["Sales & Customer Interface", "Procurement & Supply Chain", "Analytics & Strategic Planning", "Manufacturing Excellence & Project Management"],
                "FLYER Elements": ["Development", "IIM Bangalore", "Growth Opportunities", "Leadership Access"],
                "Places to explore at IIM B": ["Mustard Cafe", "Library", "Jigani Campus", "Forest trail"],
                "RIL industry bandwidth": ["Only Vimal", "Spice Trading", "Refinery", "Telecom"]
            },
            // NEW: Colors for found connections groups
            groupColors: [
                "rgba(var(--flyer-teal-rgb), 0.2)",       // Light Teal
                "rgba(var(--flyer-purple-rgb), 0.2)",     // Light Purple
                "rgba(var(--flyer-red-rgb), 0.2)",        // Light Red/Pink
                "hsl(45, 100%, 95%)"                      // Light Yellow/Gold
            ]
        },
        teamMatch: {
            prompts: [
                { id: 'p1', text: 'Owns a pet'},
                { id: 'p2', text: 'Goes to gym daily' },
                { id: 'p3', text: 'Read more than 10 books in the last year' },
                { id: 'p4', text: 'Has snacks stashed in their desk' },
                // Removed 'p5': 'Has led a team during uncertain times'
                { id: 'p5', text: 'Drinks more than 2 cups of coffee a day' },
                { id: 'p6', text: 'Is interested in transitioning into customer facing role' },
                { id: 'p7', text: 'Listened to music while working' },
                { id: 'p8', text: 'Has travelled solo / dream destination' },
                { id: 'p9', text: 'Is excited about the IIM Bangalore program' }
            ]
        },
        // Instructions for each stage, using a placeholder for team name
        instructions: {
            0: "Before we embark on this adventure, please enter your team name.",
            1: "Hey {TEAM_NAME}! Your first challenge: Solve this riddle to unlock the next stage.",
            2: "Awesome, {TEAM_NAME}! Now, find all the hidden words in the grid to proceed.",
            3: "Great job, {TEAM_NAME}! Connect the dots: Find groups of four items that share a common thread.",
            4: "Final challenge, {TEAM_NAME}! Fill your card by finding matches, and learn cool things about each other. We‚Äôll ask what you found‚Äîso listen up! Remember to take a screenshot of your card and drop it in the main chat once you're done!",
        }
    };

    // Main Game Class for managing all game logic and state
    class FlyerEscapeRoom {
        constructor() {
            this.currentStage = 0;
            this.teamName = '';

            // Word Search properties
            this.foundWords = new Set();
            this.isMouseDown = false;
            this.wordSearchSelection = [];

            // Connections game properties
            this.connectionsAllWords = [];
            this.connectionsSelectedWords = [];
            this.connectionsMatchedGroups = new Set();
            this.nextGroupColorIndex = 0; // NEW: To cycle through colors

            this.notificationTimeout = null;

            this.initDOMReferences();
            this.bindEvents();
            this.initializeStages();
            this.updateProgressBar(); // NEW: Initial progress bar update
            this.renderStage(this.currentStage); // Render initial stage (Stage 0)
        }

        /**
         * Initializes references to DOM elements used throughout the game.
         */
        initDOMReferences() {
            this.stages = document.querySelectorAll('.stage');
            // NEW: Global Header references
            this.currentStageNumberSpan = document.getElementById('currentStageNumber');
            this.progressSegments = document.querySelectorAll('.progress-segment');

            // Stage 0 (Team Name)
            this.teamNameInput = document.getElementById('teamNameInput');
            this.teamNameSubmitBtn = document.getElementById('teamNameSubmitBtn');
            // Stage 1
            this.riddleAnswerInput = document.getElementById('riddleAnswer');
            this.riddleSubmitBtn = document.getElementById('riddleSubmitBtn');
            // Stage 2
            this.wordSearchGrid = document.getElementById('grid');
            this.wordListUl = document.getElementById('words');
            // Stage 3 (Connections)
            this.connectionsContainer = document.getElementById('connections-container');
            this.foundGroupsDiv = document.getElementById('found-groups');
            this.connectionsGridDiv = document.getElementById('connections-grid');
            // Stage 4 (Team Match)
            this.promptGridDiv = document.getElementById('prompt-grid');
            this.screenshotButton = document.getElementById('screenshotButton'); // NEW: Reference to the screenshot button
            
            this.notificationArea = document.getElementById('notificationArea');
            this.confettiContainer = document.getElementById('confetti-container'); // NEW: Confetti container

            // References for stage instruction paragraphs
            this.stageInstructions = {};
            this.stages.forEach(stage => {
                const stageNum = parseInt(stage.dataset.stage);
                if (stageNum >= 0) { // Instructions start from Stage 0
                    this.stageInstructions[stageNum] = stage.querySelector(`#stage-${stageNum}-instruction`);
                }
            });
        }

        /**
         * Binds all necessary event listeners.
         */
        bindEvents() {
            // Stage 0: Team Name submission
            this.teamNameSubmitBtn.addEventListener('click', () => this.processTeamName());
            this.teamNameInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    this.processTeamName();
                }
            });

            // Stage 1: Riddle submission
            this.riddleSubmitBtn.addEventListener('click', () => this.checkRiddle());
            this.riddleAnswerInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    this.checkRiddle();
                }
            });

            // Stage 2: Word Search events
            this.wordSearchGrid.addEventListener('mousedown', this.handleWordSearchMouseDown.bind(this));
            this.wordSearchGrid.addEventListener('mouseup', this.handleWordSearchMouseUp.bind(this));
            this.wordSearchGrid.addEventListener('mouseover', this.handleWordSearchMouseOver.bind(this));
            document.addEventListener('mouseup', () => { // Global mouseup for word search
                if (this.isMouseDown) {
                    this.isMouseDown = false;
                    this.clearWordSearchSelection();
                    this.wordSearchSelection = [];
                }
            });

            // Stage 3: Connections Game events
            this.connectionsGridDiv.addEventListener('click', (event) => {
                const targetTile = event.target.closest('.tile');
                if (targetTile) {
                    this.handleConnectionsTileClick(targetTile);
                }
            });

            // NEW: Stage 4 Screenshot button
            this.screenshotButton.addEventListener('click', () => {
                this.showNotification("üí° To screenshot: Press 'PrtSc' key, then paste (Ctrl+V) into Teams chat window.", 'info', 8000);
            });
        }

        /**
         * Initializes content for each game stage.
         */
        initializeStages() {
            this.createWordSearchGrid();
            this.updateWordListDisplay();
            this.initializeConnectionsGame();
            this.createPromptGrid();
        }

        /**
         * Displays a specific game stage and hides others.
         * @param {number} stageNum The number of the stage to render (0, 1, 2, 3, or 4).
         */
        renderStage(stageNum) {
            this.stages.forEach(stage => {
                if (parseInt(stage.dataset.stage) === stageNum) {
                    stage.classList.add('active');
                } else {
                    stage.classList.remove('active');
                }
            });
            this.currentStage = stageNum;
            this.updateProgressBar(); // NEW: Update progress bar on stage change

            // Update instruction for the newly active stage
            if (this.stageInstructions[stageNum]) {
                let instructionText = CONFIG.instructions[stageNum];
                if (this.teamName) {
                    instructionText = instructionText.replace('{TEAM_NAME}', this.teamName);
                }
                this.stageInstructions[stageNum].textContent = instructionText;
            }
        }

        /**
         * NEW: Updates the global stage indicator and progress bar.
         */
        updateProgressBar() {
            // Update current stage number in header
            this.currentStageNumberSpan.textContent = this.currentStage;

            // Update progress bar segments (Stage 1 to 4 are actual game stages)
            // If currentStage is 0, no segments are active yet.
            for (let i = 0; i < this.progressSegments.length; i++) {
                const segmentStage = parseInt(this.progressSegments[i].dataset.segment);
                if (this.currentStage >= segmentStage) {
                    this.progressSegments[i].classList.add('active');
                } else {
                    this.progressSegments[i].classList.remove('active');
                }
            }
        }

        // Stage 0 Logic: Team Name Input
        processTeamName() {
            const name = this.teamNameInput.value.trim();
            if (name === '') {
                this.showNotification("Team Name cannot be blank!", 'error');
                return;
            }
            this.teamName = name;
            this.showNotification(`Welcome, ${this.teamName}! Let's begin!`, 'success');
            setTimeout(() => {
                this.renderStage(1); // Move to Stage 1
            }, 1500);
        }

        // --- Stage 1 Logic: Solve the Riddle ---
        checkRiddle() {
            const answer = this.riddleAnswerInput.value.trim().toLowerCase();
            if (answer === CONFIG.riddle.answer) {
                this.showNotification(CONFIG.riddle.successMessage, 'success');
                this.riddleSubmitBtn.disabled = true;
                this.riddleAnswerInput.disabled = true;
                this.triggerConfetti(); // NEW: Trigger confetti on stage completion
                setTimeout(() => {
                    this.renderStage(2); // Auto-advance to Stage 2
                    this.riddleAnswerInput.value = '';
                    this.riddleSubmitBtn.disabled = false;
                    this.riddleAnswerInput.disabled = false;
                }, 1500);
            } else {
                this.showNotification("‚ùå Incorrect! Try again.", 'error');
                this.riddleAnswerInput.value = '';
            }
        }

        // --- Stage 2 Logic: Word Search ---
        createWordSearchGrid() {
            this.wordSearchGrid.innerHTML = '';
            CONFIG.wordSearch.gridData.forEach((rowArr, rowIndex) => {
                rowArr.forEach((char, colIndex) => {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.textContent = char;
                    cell.dataset.row = rowIndex;
                    cell.dataset.col = colIndex;
                    this.wordSearchGrid.appendChild(cell);
                });
            });
        }

        updateWordListDisplay() {
            this.wordListUl.innerHTML = '';
            CONFIG.wordSearch.words.forEach(word => {
                const li = document.createElement('li');
                li.textContent = word;
                if (this.foundWords.has(word)) {
                    li.classList.add('found-word-list');
                }
                this.wordListUl.appendChild(li);
            });
        }

        handleWordSearchMouseDown(e) {
            if (!e.target.classList.contains('cell') || e.button !== 0) return;
            
            this.clearWordSearchSelection();
            this.isMouseDown = true;
            e.target.classList.add('selected');
            this.wordSearchSelection.push(e.target);
        }

        handleWordSearchMouseOver(e) {
            if (!this.isMouseDown || !e.target.classList.contains('cell')) return;

            const newCell = e.target;
            if (this.wordSearchSelection.includes(newCell)) return;

            const lastSelected = this.wordSearchSelection[this.wordSearchSelection.length - 1];
            if (!lastSelected) return;

            const prevRow = parseInt(lastSelected.dataset.row);
            const prevCol = parseInt(lastSelected.dataset.col);
            const newRow = parseInt(newCell.dataset.row);
            const newCol = parseInt(newCell.dataset.col);

            let isStraight = false;
            if (this.wordSearchSelection.length === 1) {
                isStraight = (newRow === prevRow) || (newCol === prevCol) ||
                             (Math.abs(newRow - prevRow) === Math.abs(newCol - prevCol));
            } else {
                const firstSelected = this.wordSearchSelection[0];
                const firstRow = parseInt(firstSelected.dataset.row);
                const firstCol = parseInt(firstSelected.dataset.col);

                const dR_initial = prevRow - firstRow;
                const dC_initial = prevCol - firstCol;
                const dR_current = newRow - firstRow;
                const dC_current = newCol - firstCol;

                isStraight = (dR_initial * dC_current - dC_initial * dR_current === 0);

                const distancePrev = Math.max(Math.abs(newRow - prevRow), Math.abs(newCol - prevCol));
                if (distancePrev !== 1) {
                    isStraight = false;
                }
            }

            if (isStraight) {
                newCell.classList.add('selected');
                this.wordSearchSelection.push(newCell);
            } else {
                this.clearWordSearchSelection();
                this.wordSearchSelection = [];
                this.isMouseDown = false;
                this.showNotification("Selection must be a straight line!", 'error', 1500);
            }
        }

        handleWordSearchMouseUp() {
            this.isMouseDown = false;
            if (this.wordSearchSelection.length === 0) {
                this.clearNotification();
                return;
            }

            const selectedWordChars = this.wordSearchSelection.map(el => el.textContent);
            const selectedWord = selectedWordChars.join('');
            const reversedSelectedWord = selectedWordChars.slice().reverse().join('');

            const foundMatch = CONFIG.wordSearch.words.find(word =>
                word === selectedWord || word === reversedSelectedWord
            );

            if (foundMatch && !this.foundWords.has(foundMatch)) {
                this.wordSearchSelection.forEach(el => el.classList.replace('selected', 'found'));
                this.foundWords.add(foundMatch);
                this.updateWordListDisplay();
                this.showNotification(`Found: "${foundMatch}"!`, 'success');

                if (this.foundWords.size === CONFIG.wordSearch.words.length) {
                    this.showNotification("üéâ All words found! Advancing to the next stage.", 'success', 2000);
                    this.triggerConfetti(); // NEW: Trigger confetti on stage completion
                    setTimeout(() => this.renderStage(3), 2500);
                }
            } else {
                this.clearWordSearchSelection();
                if (foundMatch && this.foundWords.has(foundMatch)) {
                     this.showNotification("Word already found!", 'error');
                } else {
                    this.showNotification("Not a valid word. Try again!", 'error');
                }
            }
            this.wordSearchSelection = [];
        }

        clearWordSearchSelection() {
            document.querySelectorAll('#grid .selected').forEach(el => el.classList.remove('selected'));
        }

        // --- Stage 3 Logic: Connections Game ---
        initializeConnectionsGame() {
            this.connectionsAllWords = Object.values(CONFIG.connections.categories).flat().sort(() => 0.5 - Math.random());
            this.connectionsSelectedWords = [];
            this.connectionsMatchedGroups.clear();
            this.foundGroupsDiv.innerHTML = "";
            this.nextGroupColorIndex = 0; // Reset color index
            this.createConnectionsGrid();
        }

        createConnectionsGrid() {
            this.connectionsGridDiv.innerHTML = "";
            this.connectionsAllWords.forEach(word => {
                const div = document.createElement("div");
                div.classList.add("tile");
                div.textContent = word;
                this.connectionsGridDiv.appendChild(div);
            });
        }

        handleConnectionsTileClick(tile) {
            if (tile.classList.contains("locked")) return;

            if (this.connectionsSelectedWords.length === 4 && !tile.classList.contains("selected")) {
                this.showNotification("You've already selected 4 words. Deselect one or validate.", 'error', 2000);
                return;
            }

            tile.classList.toggle("selected");
            const word = tile.textContent;

            if (tile.classList.contains("selected")) {
                this.connectionsSelectedWords.push(word);
            } else {
                this.connectionsSelectedWords = this.connectionsSelectedWords.filter(w => w !== word);
            }

            if (this.connectionsSelectedWords.length === 4) {
                this.validateConnectionsSelection();
            }
        }

        validateConnectionsSelection() {
            let foundCategory = null;
            for (const [category, words] of Object.entries(CONFIG.connections.categories)) {
                const isMatch = this.connectionsSelectedWords.every(word => words.includes(word));
                if (isMatch && !this.connectionsMatchedGroups.has(category)) {
                    foundCategory = category;
                    this.connectionsMatchedGroups.add(category);
                    break;
                }
            }

            if (foundCategory) {
                this.showConnectionsGroup(foundCategory);
                this.showNotification(`Correct! Found: "${foundCategory}"`, 'success');
                if (this.connectionsMatchedGroups.size === Object.keys(CONFIG.connections.categories).length) {
                    this.showNotification("üéâ All connections found! Advancing to the final stage.", 'success', 2500);
                    this.triggerConfetti(); // NEW: Trigger confetti on stage completion
                    setTimeout(() => this.renderStage(4), 3000);
                }
            } else {
                this.showWrongConnectionsSelection();
                this.showNotification("Incorrect group. Try again!", 'error');
            }
            this.connectionsSelectedWords = []; // Clear selection for next attempt
        }

        showConnectionsGroup(category) {
            const groupDiv = document.createElement("div");
            groupDiv.className = "group";
            // NEW: Assign a unique background color to the group
            groupDiv.style.backgroundColor = CONFIG.connections.groupColors[this.nextGroupColorIndex % CONFIG.connections.groupColors.length];
            this.nextGroupColorIndex++; // Move to next color

            const label = document.createElement("div");
            label.className = "group-label";
            label.textContent = category;
            groupDiv.appendChild(label);

            const tilesToMove = [];
            document.querySelectorAll('#connections-grid .tile.selected').forEach(tile => {
                tilesToMove.push(tile);
            });

            tilesToMove.forEach(tile => {
                tile.classList.remove("selected");
                tile.classList.add("locked"); // Add locked class
                tile.style.backgroundColor = 'transparent'; // Tile itself is transparent, inherits group color
                groupDiv.appendChild(tile); // Move tile into the group div
            });
            this.foundGroupsDiv.appendChild(groupDiv);
        }

        showWrongConnectionsSelection() {
            document.querySelectorAll('#connections-grid .tile.selected').forEach(tile => {
                tile.classList.add("wrong");
                setTimeout(() => {
                    tile.classList.remove("wrong");
                    tile.classList.remove("selected");
                }, 400); // Timing confirmed by user
            });
        }

        // --- Stage 4 Logic: Match the Team ---
        createPromptGrid() {
            this.promptGridDiv.innerHTML = '';
            CONFIG.teamMatch.prompts.forEach(prompt => {
                const div = document.createElement('div');
                div.classList.add('prompt');
                div.innerHTML = `<p>${prompt.text}</p><input type="text" data-prompt-id="${prompt.id}" placeholder="Enter Name" />`;
                this.promptGridDiv.appendChild(div);
            });
        }

        // --- General Utilities ---
        showNotification(message, type, duration = 3000) {
            if (this.notificationTimeout) {
                clearTimeout(this.notificationTimeout);
            }

            this.notificationArea.textContent = message;
            this.notificationArea.className = `notification-message ${type} visible`;
            
            if (duration > 0) {
                this.notificationTimeout = setTimeout(() => {
                    this.clearNotification();
                }, duration);
            }
        }

        clearNotification() {
            this.notificationArea.classList.remove('visible');
            setTimeout(() => {
                this.notificationArea.className = 'notification-message';
                this.notificationArea.textContent = '';
            }, 300);
        }

        // NEW: Confetti Trigger Function
        triggerConfetti() {
            const numParticles = 100; // UPDATED: More confetti
            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div');
                particle.classList.add('confetti-particle');
                
                // Randomize initial position, size, and animation delay
                const startX = Math.random() * window.innerWidth;
                const startY = Math.random() * -50; // Start slightly above view
                const endX = startX + (Math.random() - 0.5) * 600; // Drift left/right (slightly more spread)
                const endY = window.innerHeight + 50; // Fall past bottom

                particle.style.left = `${startX}px`;
                particle.style.top = `${startY}px`;
                particle.style.setProperty('--x-end', `${endX - startX}px`);
                particle.style.setProperty('--y-end', `${endY - startY}px`);
                particle.style.animationDelay = `${Math.random() * 0.8}s`;
                particle.style.animationDuration = `${2 + Math.random() * 1.5}s`; // 2 to 3.5 seconds fall

                const size = 5 + Math.random() * 10; // 5px to 15px
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;

                this.confettiContainer.appendChild(particle);

                // Clean up particle after its animation
                particle.addEventListener('animationend', () => {
                    particle.remove();
                });
            }
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        new FlyerEscapeRoom();
    });
</script>
</body>
</html>
